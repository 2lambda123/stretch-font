{"version":3,"file":"stretch-font.min.js","sources":["stretch-font.js"],"sourcesContent":["/**\n * The `useStretchFont` function adjusts the font size of HTML elements based on their width and specified minimum and\n * maximum font size values.\n * @param [className=stretch-font] - The class name that identifies the elements that should have their font size\n * stretched. The default value is \"stretch-font\".\n * @param [root] - The `root` parameter is an optional argument that specifies the root element to search for nodes with\n * the class name `className`. If no `root` element is specified, the function will search the entire document for nodes\n * with the class name `className`.\n */\nfunction useStretchFont(root = document, className = 'stretch-font') {\n  const tmplClass = 'stretch-font__tmpl'\n  const store = new Map()\n\n  let resizeObserver = null\n  let tmpl = null\n\n  const body = document.getElementsByTagName('body')[0]\n\n  // Create template for width container\n  if (!body.querySelector('.' + tmplClass)) {\n    tmpl = document.createElement('div')\n    tmpl.classList.add(tmplClass)\n    body.appendChild(tmpl)\n  }\n\n  // Helpers\n  function uniqArrayKeys(array) {\n    return [...new Set(array)]\n  }\n  function getWidth(node) {\n    return node.getBoundingClientRect().width\n  }\n  function storeSave(node, payload = {}) {\n    if (!payload && !Object.keys(payload).length) return\n    const o = store.get(node)\n    store.set(node, { ...o, ...payload })\n  }\n\n  // Get and save to store\n  function setSize(node) {\n    if (store.get(node)?.size) return\n    const size = getFontSize(node)\n\n    storeSave(node, { size })\n  }\n  function setMin(node) {\n    if (store.get(node)?.min) return\n    let { stretchMin: min } = node.dataset\n\n    storeSave(node, { min: +min })\n  }\n  function setMax(node) {\n    if (!('stretchMax' in node.dataset)) return\n    if (!node.dataset.stretchMax) return\n\n    if (store.get(node)?.max) return\n    let { stretchMax: max } = node.dataset\n\n    storeSave(node, { max: +max })\n  }\n  function setWidth(node) {\n    const o = store.get(node)\n\n    const n = document.createElement('span')\n    n.innerHTML = node.innerHTML\n    n.style.fontSize = o.size + 'px'\n    tmpl.appendChild(n)\n\n    const { width } = n.getBoundingClientRect()\n    const freeze = 'stretch' in node.dataset ? 0 : !o.freeze ? width : o.freeze\n\n    storeSave(node, { width, freeze })\n\n    n.remove()\n  }\n\n  /**\n   * The function returns the font size of a given node element.\n   * @param node - The node parameter is a reference to a DOM element whose font size is to be retrieved.\n   * @returns The function `getFontSize` returns the computed font size of the specified `node` element.\n   */\n  function getFontSize(node) {\n    return +self.getComputedStyle(node, null).getPropertyValue('font-size').slice(0, -2)\n  }\n\n  /**\n   * The function adjusts the font size of a given node based on its width and predefined size, minimum and maximum values.\n   * @param node - The HTML element node that we want to apply the font size formula to.\n   */\n  function formula(node) {\n    let { size, min, max, width, freeze } = store.get(node)\n\n    const calc = ((freeze || node.getBoundingClientRect().width) / width) * size * 0.985\n    const x = calc > max ? max : calc < min ? min : calc\n\n    node.style.fontSize = x + 'px'\n  }\n\n  /**\n   * The function resizes the font of entries using requestAnimationFrame.\n   * @param entries - The `entries` parameter is an array of `IntersectionObserverEntry` objects. These objects represent\n   * the elements that are being observed by an `IntersectionObserver` instance and contain information about their\n   * intersection with the viewport. In this case, the `entries` array is being passed to a function called `entries\n   */\n  function entriesResize(entries) {\n    self.requestAnimationFrame(() => entries.forEach(({ target }) => formula(target)))\n  }\n\n  /**\n   * The function finds all nodes with a specific class name within a given target element.\n   * @param target - The target parameter is a DOM element that is being searched for nodes with a specific class name.\n   * @returns The function `findNodes` returns an array of DOM elements that have a class name matching the `className`\n   * parameter. If the `target` parameter itself has the matching class name, it will be the only element in the returned\n   * array. If there are no matching elements, an empty array will be returned.\n   */\n  function getNodes(target) {\n    return target.querySelectorAll('.' + className) || []\n  }\n\n  /**\n   * The function \"rebuild\" performs various operations on a given node element, including setting its minimum and maximum\n   * size, calculating its size and width, applying a formula, and observing its resizing.\n   * @param node - The node parameter is a reference to a DOM element that needs to be rebuilt. The function rebuild() is\n   * responsible for setting various properties and attributes of the node, such as its minimum and maximum size, its size,\n   * and its width. It also calls a formula() function and sets up a resizeObserver\n   */\n  function rebuild(node) {\n    if ('stretchMin' in node.dataset) setMin(node)\n    if ('stretchMax' in node.dataset) setMax(node)\n    setSize(node)\n    setWidth(node)\n\n    formula(node)\n    resizeObserver.observe(node)\n  }\n\n  self.addEventListener('DOMContentLoaded', () => {\n    // Watch resize\n    resizeObserver = new ResizeObserver(entriesResize)\n\n    // init\n    getNodes(root).forEach(rebuild)\n\n    // Watch mutation\n    new MutationObserver(entries => {\n      const manipulate = entries\n        .filter(({ type, target }) => type === 'childList' && !target.classList?.contains(tmplClass))\n        .map(({ target }) => {\n          if (target.classList?.contains(className)) return target\n          return [...Array.from(getNodes(target)).filter(node => !store.has(node))]\n        })\n        .flat()\n\n      const mutation = entries\n        .filter(({ type, target: { parentNode } }) => {\n          if (type !== 'characterData') return\n          if (!parentNode.classList?.contains(className)) return\n          if (!store.has(parentNode)) return\n          return store.get(parentNode).width !== getWidth(parentNode)\n        })\n        .map(({ target }) => target.parentNode)\n\n      uniqArrayKeys([...mutation, ...manipulate]).forEach(rebuild)\n    }).observe(root, { characterData: true, childList: true, subtree: true })\n  })\n}\n\nexport default useStretchFont\n"],"names":["root","arguments","length","undefined","document","className","tmplClass","store","Map","resizeObserver","tmpl","body","getElementsByTagName","storeSave","node","payload","Object","keys","o","get","set","_objectSpread","setSize","_store$get","size","self","getComputedStyle","getPropertyValue","slice","getFontSize","formula","_store$get4","min","max","width","calc","freeze","getBoundingClientRect","x","style","fontSize","entriesResize","entries","requestAnimationFrame","forEach","_ref","target","getNodes","querySelectorAll","rebuild","dataset","_store$get2","stretchMin","setMin","_store$get3","stretchMax","setMax","n","createElement","innerHTML","appendChild","remove","setWidth","observe","querySelector","classList","add","addEventListener","ResizeObserver","MutationObserver","array","manipulate","filter","_ref2","_target$classList","type","contains","map","_ref3","_target$classList2","_toConsumableArray","Array","from","has","flat","mutation","_ref4","_parentNode$classList","parentNode","_ref5","concat","Set","characterData","childList","subtree"],"mappings":"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"}